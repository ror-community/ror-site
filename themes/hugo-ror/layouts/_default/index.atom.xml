{{- $pages := where .Site.RegularPages "Type" "in" .Site.Params.mainSections -}}
{{- with .Site.Config.Services.RSS.Limit -}}
  {{- if ge . 1 -}}
    {{- $pages = $pages | first . -}}
  {{- end -}}
{{- end -}}
{{ print "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<feed xmlns="http://www.w3.org/2005/Atom" xmlns:webfeeds="http://webfeeds.org/rss/1.0">
  <title>{{ .Site.Title }}</title>
  {{ with .Site.Params.Description }}<subtitle>{{ .  }}</subtitle>{{ end }}
  {{ with .Site.Params.Author.name }}
  <author>
    <name>{{ . }}</name>
    <uri>{{ $.Site.BaseURL }}</uri>
  </author>
  {{ end }}
  <id>{{ .Permalink }}</id>
  {{ with .OutputFormats.Get "atom" }}
  {{ printf `<link rel="self" type="%s" href="%s" hreflang="%s"/>` .MediaType.Type .Permalink $.Site.LanguageCode | safeHTML }}
  {{ end }}
  {{ range .AlternativeOutputFormats }}
  {{ printf `<link rel="alternate" type="%s" href="%s" hreflang="%s"/>` .MediaType.Type .Permalink $.Site.LanguageCode | safeHTML }}
  {{ end }}
  {{ with .Site.LanguageCode }} 
  <language>{{.}}</language>{{end}}
  <generator uri="https://gohugo.io">Hugo {{ .Site.Hugo.Version }}</generator>  
  {{ with .Site.Params.icon }}<icon>{{ . | absURL }}</icon>{{ end }}
  {{ with .Site.Params.logo }}<logo>{{ . | absURL }}</logo>{{ end }}
  {{ with .Site.Copyright }}<rights>{{ replace . "{year}" now.Year }}</rights>{{ end }}
  <updated>{{ now.Format .Site.Params.dateFormatAtomFeed | safeHTML }}</updated>
  {{ with .Site.Params.icon96 }}<webfeeds:icon>{{ . | absURL }}</webfeeds:icon>{{ end }}
  {{ range $pages }}
  <entry>
    <title>{{ .Title }}</title>    
    <link rel="alternate" href="{{ .Permalink }}"/>
    <id>{{ .Permalink }}</id>
    <published>{{ .Date.Format .Site.Params.dateFormatAtomFeed | safeHTML }}</published>
    <updated>{{ .Lastmod.Format .Site.Params.dateFormatAtomFeed | safeHTML }}</updated>
    
	{{ if isset .Params "authors" }}
	{{ range $author := .Params.authors }}
	<author>
		<name>{{ $author }}</name>
	</author>
	{{ end }}
    {{ else if .Params.author }}
	<author>
		<name>{{ . }}</name>
	</author>         
    {{ else }}
	<author>
		<name>{{ .Site.Params.Author.name }}</name>
	</author>	
	{{ end }}

    <content type="html" xml:base="{{ .Site.BaseURL }}" xml:lang="en">
      {{ printf "<![CDATA[%s]]>" .Content | safeHTML }}
    </content>
    <summary type="text/html" xml:base="{{ .Site.BaseURL }}" xml:lang="en">
    {{ if .Description }} {{ .Description | html }} {{ else }} {{ .Summary | html }} {{ end }}
    </summary>
  </entry>
  {{ end }}
</feed>